apiVersion: core.humio.com/v1alpha1
kind: HumioPdfRenderService
metadata:
  name: pdf-render-service
  namespace: logging
spec:
  # Required fields
  image: humio/pdf-render-service:0.0.60--build-102--sha-c8eb95329236ba5fc65659b83af1d84b4703cb1e
  # Optional fields
  # Image pull secrets
  imagePullSecrets:
    - name: regcred
  # Number of replicas to run/humio-operator/pkg/humio/humio_tes
  replicas: 2
  # Port configuration
  port: 5123
  # Service type (matches the Terraform configuration)
  serviceType: ClusterIP
  # Environment variables
  env:
    - name: XDG_CONFIG_HOME
      value: /tmp/.chromium-config
    - name: XDG_CACHE_HOME
      value: /tmp/.chromium-cache
    - name: DEBUG
      value: "true"
    - name: LOG_LEVEL
      value: "debug"
    - name: CLEANUP_INTERVAL
      value: "600"
    - name: PORT
      value: "5123"
    - name: SERVICE_VERSION
      value: 0.28.29 
  # Resource requirements
  resources:
    limits:
      cpu: "1"
      memory: "2Gi"
    requests:
      cpu: "1"
      memory: "1Gi"
  # Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /ready
      port: 5123
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 60
    failureThreshold: 1
    successThreshold: 1
  # Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /health
      port: 5123
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 60
    failureThreshold: 5
    successThreshold: 1
  # Node affinity configuration
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: humio_node_type
            operator: In
            values:
            - core
  # Add annotations for service
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/path: /metrics
    prometheus.io/port: "5123"
  # Volume mounts for the container
  volumeMounts:
    - name: app-temp
      mountPath: /app/temp
    - name: tmp
      mountPath: /tmp
  # Volumes for the pod
  volumes:
    - name: app-temp
      emptyDir:
        medium: Memory
    - name: tmp
      emptyDir:
        medium: Memory
  # Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    privileged: false
    readOnlyRootFilesystem: true
    runAsGroup: 1000
    runAsNonRoot: true
    runAsUser: 1000
  # Pod security context (empty in the example)
  podSecurityContext: {}
